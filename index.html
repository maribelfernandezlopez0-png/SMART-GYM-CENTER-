<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.M.G CENTER - SISTEMA VIP</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --dark: #050505; --card: #0f0f0f; --accent: #ff0000; --gold: #ffcc00; --text: #ffffff; --green: #00ff44; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--dark); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        /* SIDEBAR */
        .sidebar { width: 260px; background: #000; border-right: 2px solid var(--accent); display: flex; flex-direction: column; }
        .logo-box { padding: 40px 20px; text-align: center; border-bottom: 1px solid #222; }
        .logo-box i { font-size: 50px; color: var(--accent); filter: drop-shadow(0 0 10px red); }
        .sidebar nav a { display: flex; align-items: center; padding: 18px 25px; color: #888; text-decoration: none; font-size: 14px; font-weight: bold; text-transform: uppercase; cursor: pointer; }
        .sidebar nav a:hover, .sidebar nav a.active { background: #111; color: #fff; border-left: 5px solid var(--accent); }
        .sidebar nav a i { margin-right: 15px; }

        /* CONTENIDO PRINCIPAL */
        .main { flex: 1; padding: 40px; overflow-y: auto; background: radial-gradient(circle at top right, #110000 0%, #000 100%); }
        h2 { color: var(--accent); text-transform: uppercase; margin-bottom: 25px; border-left: 5px solid var(--accent); padding-left: 15px; }

        /* ESTADÍSTICAS RÁPIDAS (DASHBOARD) */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid #222; text-align: center; }
        .stat-card i { font-size: 25px; color: var(--accent); margin-bottom: 10px; }
        .stat-card h3 { margin: 0; font-size: 24px; color: var(--gold); }
        .stat-card p { margin: 5px 0 0; color: #888; font-size: 12px; font-weight: bold; }

        .glass-panel { background: var(--card); padding: 30px; border-radius: 15px; border: 1px solid #222; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* BUSCADOR */
        .search-container { position: relative; margin-bottom: 20px; }
        .search-box { width: 100%; padding: 15px 15px 15px 45px; background: #111; border: 1px solid #333; color: #fff; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        .search-container i { position: absolute; left: 15px; top: 18px; color: var(--accent); }

        /* TABLA */
        table { width: 100%; border-collapse: collapse; }
        th { color: var(--gold); font-size: 11px; padding: 15px; border-bottom: 2px solid var(--accent); text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #222; text-align: center; font-size: 14px; }
        .nombre-link { color: #fff; cursor: pointer; font-weight: bold; text-decoration: none; }
        .nombre-link:hover { color: var(--accent); text-shadow: 0 0 5px red; }

        /* INPUTS */
        label { display: block; margin-bottom: 5px; color: #888; font-size: 11px; font-weight: bold; }
        input, select { width: 100%; padding: 12px; margin-bottom: 15px; background: #000; color: #fff; border: 1px solid #333; border-radius: 8px; box-sizing: border-box; }
        .btn-add { background: var(--accent); color: #fff; border: none; padding: 15px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; text-transform: uppercase; }

        .status-badge { padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 10px; }
        .status-vigente { background: var(--green); color: #000; }
        .status-vencido { background: var(--accent); color: #fff; }

        /* VENTANA MODAL (FICHA TÉCNICA) */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); align-items: center; justify-content: center; }
        .modal-content { background: #111; border: 2px solid var(--accent); padding: 30px; border-radius: 20px; width: 90%; max-width: 420px; text-align: center; position: relative; animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 25px; color: #fff; cursor: pointer; }
        .profile-img { width: 180px; height: 180px; border-radius: 20px; border: 3px solid var(--accent); object-fit: cover; margin-bottom: 15px; background: #222; box-shadow: 0 0 20px rgba(255,0,0,0.5); }
        .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #222; font-size: 14px; }
        .info-row b { color: var(--gold); }

        /* IMPRESIÓN */
        #ticket-print { display: none; background: #fff; color: #000; padding: 20px; font-family: 'Courier New', monospace; text-align: center; border: 1px solid #000; }
        @media print { body * { visibility: hidden; } #ticket-print, #ticket-print * { visibility: visible; } #ticket-print { position: absolute; left: 0; top: 0; display: block; width: 100%; } }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo-box">
        <i class="fa-solid fa-dumbbell"></i>
        <div style="margin-top:10px; font-weight:bold; letter-spacing: 1px;">S.M.G CENTER</div>
    </div>
    <nav>
        <a onclick="show('registrar')" id="n-registrar" class="active"><i class="fa fa-user-plus"></i> REGISTRAR</a>
        <a onclick="show('lista')" id="n-lista"><i class="fa fa-users"></i> PANEL SOCIOS</a>
    </nav>
</div>

<div class="main">
    <div id="registrar" class="section">
        <h2 id="form-title">Nuevo Registro</h2>
        <div class="glass-panel" style="max-width: 500px;">
            <input type="hidden" id="edit-index" value="-1">
            <label>NOMBRE COMPLETO</label>
            <input type="text" id="reg-nombre" placeholder="EJ: CRISTIAN SORIANO">
            
            <label>URL DE LA FOTO DEL CLIENTE</label>
            <input type="text" id="reg-foto" placeholder="Pega el link de la imagen aquí">
            
            <div style="display:flex; gap:15px;">
                <div style="flex:1;"><label>INICIO</label><input type="date" id="reg-inicio" onchange="actualizarFechas()"></div>
                <div style="flex:1;"><label>PLAN</label>
                    <select id="reg-plan" onchange="actualizarFechas()">
                        <option value="SEMANAL">SEMANAL ($150)</option>
                        <option value="MENSUAL">MENSUAL ($380)</option>
                    </select>
                </div>
            </div>
            <label>VENCIMIENTO (EL PAGO TOCA ESTE DÍA)</label>
            <input type="date" id="reg-vence" readonly style="color:var(--accent); font-weight:bold; background:#111; text-align:center;">
            
            <button class="btn-add" id="btn-save" onclick="guardarSocio()">GUARDAR E IMPRIMIR</button>
            <button class="btn-add" id="btn-cancel" onclick="cancelarEdicion()" style="display:none; background:#333; margin-top:10px;">CANCELAR</button>
        </div>
    </div>

    <div id="lista" class="section" style="display:none;">
        <div class="stats-grid">
            <div class="stat-card"><i class="fa fa-users"></i><h3 id="dash-total">0</h3><p>TOTAL SOCIOS</p></div>
            <div class="stat-card"><i class="fa fa-check-circle" style="color:var(--green)"></i><h3 id="dash-vigente">0</h3><p>VIGENTES</p></div>
            <div class="stat-card"><i class="fa fa-exclamation-triangle"></i><h3 id="dash-vencido">0</h3><p>POR VENCER/VENCIDOS</p></div>
        </div>

        <h2>Gestión de Socios</h2>
        <div class="search-container">
            <i class="fa fa-search"></i>
            <input type="text" class="search-box" id="buscador" placeholder="Escribe el nombre para buscar..." onkeyup="renderSocios()">
        </div>
        <div class="glass-panel">
            <table>
                <thead><tr><th>Socio (Ver Ficha)</th><th>Estado</th><th>Vencimiento</th><th>Acción</th></tr></thead>
                <tbody id="lista-socios"></tbody>
            </table>
        </div>
    </div>
</div>

<div id="modalInfo" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="cerrarModal()">&times;</span>
        <img id="m-foto" src="" class="profile-img">
        <h2 id="m-nombre" style="margin: 0 0 20px; color:var(--gold); border:none; padding:0; text-align: center;"></h2>
        
        <div id="m-detalles">
            <div class="info-row"><span>ESTADO:</span><span id="m-estado"></span></div>
            <div class="info-row"><span>PLAN:</span><b id="m-plan"></b></div>
            <div class="info-row"><span>FECHA INICIO:</span><span id="m-inicio"></span></div>
            <div class="info-row"><span>VENCIMIENTO:</span><b id="m-vence" style="color:var(--accent)"></b></div>
        </div>
        
        <button class="btn-add" style="margin-top:20px; background:#222;" onclick="cerrarModal()">CERRAR FICHA</button>
    </div>
</div>

<div id="ticket-print"></div>

<script>
    let socios = JSON.parse(localStorage.getItem('smg_data')) || [];
    const bip = new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3');
    const FOTO_DEFAULT = "https://cdn-icons-png.flaticon.com/512/3135/3135715.png";

    function show(id) {
        document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
        document.getElementById('n-'+id).classList.add('active');
        if(id === 'lista') renderSocios();
    }

    function actualizarFechas() {
        const inicio = document.getElementById('reg-inicio').value;
        if(!inicio) return;
        const fecha = new Date(inicio + 'T00:00:00');
        const plan = document.getElementById('reg-plan').value;
        fecha.setDate(fecha.getDate() + (plan === 'SEMANAL' ? 7 : 30));
        fecha.setDate(fecha.getDate() - 1); 
        document.getElementById('reg-vence').value = fecha.toISOString().split('T')[0];
    }

    function guardarSocio() {
        const nombre = document.getElementById('reg-nombre').value.toUpperCase();
        const vence = document.getElementById('reg-vence').value;
        const index = document.getElementById('edit-index').value;
        const foto = document.getElementById('reg-foto').value || FOTO_DEFAULT;

        if(!nombre || !vence) return alert("Completa los campos obligatorios");

        const datos = { 
            nombre, vence, foto, 
            plan: document.getElementById('reg-plan').value, 
            inicio: document.getElementById('reg-inicio').value 
        };

        if(index === "-1") socios.push(datos);
        else { socios[index] = datos; cancelarEdicion(); }

        localStorage.setItem('smg_data', JSON.stringify(socios));
        bip.play();
        imprimirTicket(datos);
        show('lista');
    }

    function renderSocios() {
        const tbody = document.getElementById('lista-socios');
        const filtro = document.getElementById('buscador').value.toUpperCase();
        tbody.innerHTML = '';
        const hoy = new Date().toISOString().split('T')[0];
        
        let vigentes = 0;
        let vencidos = 0;

        socios.forEach((s, i) => {
            const esVigente = s.vence >= hoy;
            if(esVigente) vigentes++; else vencidos++;

            if(s.nombre.includes(filtro)) {
                tbody.innerHTML += `<tr>
                    <td style="text-align:left;"><a class="nombre-link" onclick="verFicha(${i})"><i class="fa fa-id-card" style="margin-right:10px; color:var(--gold)"></i>${s.nombre}</a></td>
                    <td><span class="status-badge ${esVigente ? 'status-vigente' : 'status-vencido'}">${esVigente ? 'VIGENTE' : 'VENCIDO'}</span></td>
                    <td>${s.vence}</td>
                    <td><button class="btn-add" style="padding:5px 10px; font-size:10px;" onclick="prepararEdicion(${i})">RENOVAR</button></td>
                </tr>`;
            }
        });

        document.getElementById('dash-total').innerText = socios.length;
        document.getElementById('dash-vigente').innerText = vigentes;
        document.getElementById('dash-vencido').innerText = vencidos;
    }

    function verFicha(i) {
        const s = socios[i];
        const hoy = new Date().toISOString().split('T')[0];
        const esVigente = s.vence >= hoy;

        document.getElementById('m-foto').src = s.foto;
        document.getElementById('m-nombre').innerText = s.nombre;
        document.getElementById('m-plan').innerText = s.plan;
        document.getElementById('m-inicio').innerText = s.inicio || '---';
        document.getElementById('m-vence').innerText = s.vence;
        document.getElementById('m-estado').innerHTML = `<span class="status-badge ${esVigente ? 'status-vigente' : 'status-vencido'}">${esVigente ? 'SOCIO ACTIVO' : 'PAGO PENDIENTE'}</span>`;
        
        document.getElementById('modalInfo').style.display = 'flex';
    }

    function cerrarModal() { document.getElementById('modalInfo').style.display = 'none'; }

    function prepararEdicion(i) {
        const s = socios[i];
        document.getElementById('form-title').innerText = "Renovar Socio";
        document.getElementById('reg-nombre').value = s.nombre;
        document.getElementById('reg-foto').value = s.foto === FOTO_DEFAULT ? "" : s.foto;
        document.getElementById('edit-index').value = i;
        document.getElementById('btn-save').innerText = "GUARDAR RENOVACIÓN";
        document.getElementById('btn-cancel').style.display = "block";
        show('registrar');
    }

    function cancelarEdicion() {
        document.getElementById('form-title').innerText = "Nuevo Registro";
        document.getElementById('reg-nombre').value = "";
        document.getElementById('reg-foto').value = "";
        document.getElementById('edit-index').value = "-1";
        document.getElementById('btn-save').innerText = "GUARDAR E IMPRIMIR";
        document.getElementById('btn-cancel').style.display = "none";
    }

    function eliminarSocio(i) {
        if(confirm("¿Borrar definitivamente?")) {
            socios.splice(i, 1);
            localStorage.setItem('smg_data', JSON.stringify(socios));
            renderSocios();
        }
    }

    function imprimirTicket(s) {
        const t = document.getElementById('ticket-print');
        t.innerHTML = `<h2>SMG CENTER</h2><hr>CLIENTE: ${s.nombre}<br>VENCIMIENTO: ${s.vence}<hr>¡GRACIAS POR TU PAGO!`;
        window.print();
    }
</script>
</body>
</html>


