<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.M.G CENTER - SISTEMA PROFESIONAL</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --dark: #050505; --card: #0f0f0f; --accent: #ff0000; --gold: #ffcc00; --text: #ffffff; --green: #00ff44; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--dark); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        /* SIDEBAR */
        .sidebar { width: 260px; background: #000; border-right: 2px solid var(--accent); display: flex; flex-direction: column; }
        .logo-box { padding: 40px 20px; text-align: center; border-bottom: 1px solid #222; }
        .logo-box i { font-size: 50px; color: var(--accent); filter: drop-shadow(0 0 10px red); }
        .sidebar nav a { display: flex; align-items: center; padding: 18px 25px; color: #888; text-decoration: none; font-size: 14px; font-weight: bold; text-transform: uppercase; cursor: pointer; }
        .sidebar nav a:hover, .sidebar nav a.active { background: #111; color: #fff; border-left: 5px solid var(--accent); }
        .sidebar nav a i { margin-right: 15px; }

        /* MAIN CONTENT */
        .main { flex: 1; padding: 40px; overflow-y: auto; background: radial-gradient(circle at top right, #110000 0%, #000 100%); }
        h2 { color: var(--accent); text-transform: uppercase; margin-bottom: 30px; border-left: 5px solid var(--accent); padding-left: 15px; }
        
        .glass-panel { background: var(--card); padding: 30px; border-radius: 15px; border: 1px solid #222; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* BUSCADOR */
        .search-box { width: 100%; padding: 15px; background: #111; border: 1px solid #333; color: #fff; border-radius: 10px; margin-bottom: 20px; font-size: 16px; }

        /* TABLAS */
        table { width: 100%; border-collapse: collapse; }
        th { color: var(--gold); font-size: 12px; padding: 15px; border-bottom: 2px solid var(--accent); text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #222; text-align: center; }

        /* FORMULARIO */
        label { display: block; margin-bottom: 5px; color: #888; font-size: 12px; font-weight: bold; }
        input, select { width: 100%; padding: 12px; margin-bottom: 20px; background: #000; color: #fff; border: 1px solid #333; border-radius: 8px; box-sizing: border-box; }
        input:focus { border-color: var(--accent); outline: none; }

        .btn-add { background: var(--accent); color: #fff; border: none; padding: 15px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        .btn-add:hover { transform: scale(1.02); box-shadow: 0 0 15px var(--accent); }

        .status-badge { padding: 5px 10px; border-radius: 4px; font-weight: bold; font-size: 11px; }
        .status-vigente { background: var(--green); color: #000; }
        .status-vencido { background: var(--accent); color: #fff; }

        .btn-edit { background: var(--gold); color: #000; border: none; padding: 8px 12px; border-radius: 5px; font-weight: bold; cursor: pointer; }

        /* IMPRESI√ìN */
        #ticket-print { display: none; background: #fff; color: #000; padding: 20px; font-family: 'Courier New', monospace; width: 300px; text-align: center; border: 1px solid #000; }
        @media print { body * { visibility: hidden; } #ticket-print, #ticket-print * { visibility: visible; } #ticket-print { position: absolute; left: 0; top: 0; display: block; } }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo-box">
        <i class="fa-solid fa-dumbbell"></i>
        <div style="margin-top:10px; font-weight:bold; letter-spacing: 2px;">S.M.G CENTER</div>
    </div>
    <nav>
        <a onclick="show('registrar')" id="n-registrar" class="active"><i class="fa fa-user-plus"></i> Registrar</a>
        <a onclick="show('lista')" id="n-lista"><i class="fa fa-users"></i> Panel Socios</a>
    </nav>
</div>

<div class="main">
    <div id="registrar" class="section">
        <h2 id="form-title">Nuevo Registro</h2>
        <div class="glass-panel" style="max-width: 550px;">
            <input type="hidden" id="edit-index" value="-1">
            
            <label>NOMBRE COMPLETO DEL SOCIO</label>
            <input type="text" id="reg-nombre" placeholder="EJ: CRISTIAN SORIANO">
            
            <div style="display:flex; gap:15px;">
                <div style="flex:1;">
                    <label>FECHA DE INICIO</label>
                    <input type="date" id="reg-inicio" onchange="calcularVencimiento()">
                </div>
                <div style="flex:1;">
                    <label>PLAN ELEGIDO</label>
                    <select id="reg-plan" onchange="calcularVencimiento()">
                        <option value="SEMANAL">SEMANAL ($150)</option>
                        <option value="MENSUAL">MENSUAL ($380)</option>
                    </select>
                </div>
            </div>
            
            <label>VENCIMIENTO (EL SOCIO PAGA ESTE D√çA)</label>
            <input type="date" id="reg-vence" readonly style="color:var(--accent); font-weight:bold; font-size: 18px; text-align: center; background: #111;">
            
            <button class="btn-add" id="btn-save" onclick="guardarSocio()">REGISTRAR E IMPRIMIR</button>
            <button class="btn-add" id="btn-cancel" onclick="cancelarEdicion()" style="display:none; background:#333; margin-top:10px;">CANCELAR EDICI√ìN</button>
        </div>
    </div>

    <div id="lista" class="section" style="display:none;">
        <h2>Gesti√≥n de Socios</h2>
        <input type="text" class="search-box" id="buscador" placeholder="üîç Buscar socio por nombre..." onkeyup="renderSocios()">
        <div class="glass-panel">
            <table>
                <thead>
                    <tr><th>Socio</th><th>Estado</th><th>Vencimiento</th><th>Acciones</th></tr>
                </thead>
                <tbody id="lista-socios"></tbody>
            </table>
        </div>
    </div>

    <div id="ticket-print"></div>
</div>

<script>
    let socios = JSON.parse(localStorage.getItem('smg_data')) || [];
    const audioBip = new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3');

    function show(id) {
        document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
        document.getElementById('n-'+id).classList.add('active');
        if(id === 'lista') renderSocios();
    }

    function calcularVencimiento() {
        const inicioVal = document.getElementById('reg-inicio').value;
        if(!inicioVal) return;
        
        // Usar T00:00:00 para evitar errores de zona horaria
        const fecha = new Date(inicioVal + 'T00:00:00');
        const plan = document.getElementById('reg-plan').value;
        
        // Sumamos los d√≠as seg√∫n el plan
        fecha.setDate(fecha.getDate() + (plan === 'SEMANAL' ? 7 : 30));
        
        // Restamos 1 d√≠a para que el vencimiento sea justo antes del pago
        fecha.setDate(fecha.getDate() - 1);
        
        document.getElementById('reg-vence').value = fecha.toISOString().split('T')[0];
    }

    function guardarSocio() {
        const nombre = document.getElementById('reg-nombre').value.toUpperCase();
        const vence = document.getElementById('reg-vence').value;
        const index = document.getElementById('edit-index').value;

        if(!nombre || !vence) return alert("¬°Por favor, completa los datos!");

        const datos = { 
            nombre, 
            vence, 
            plan: document.getElementById('reg-plan').value,
            inicio: document.getElementById('reg-inicio').value 
        };

        if(index === "-1") {
            socios.push(datos);
        } else {
            socios[index] = datos;
            cancelarEdicion();
        }

        localStorage.setItem('smg_data', JSON.stringify(socios));
        
        // Alerta sonora y confirmaci√≥n
        audioBip.play();
        imprimirTicket(datos);
        show('lista');
    }

    function renderSocios() {
        const tbody = document.getElementById('lista-socios');
        const filtro = document.getElementById('buscador').value.toUpperCase();
        tbody.innerHTML = '';
        const hoy = new Date().toISOString().split('T')[0];

        socios.forEach((s, i) => {
            if(s.nombre.includes(filtro)) {
                const esVigente = s.vence >= hoy;
                tbody.innerHTML += `<tr>
                    <td style="text-align:left;"><b>${s.nombre}</b></td>
                    <td><span class="status-badge ${esVigente ? 'status-vigente' : 'status-vencido'}">${esVigente ? 'VIGENTE' : 'VENCIDO'}</span></td>
                    <td style="font-family: monospace;">${s.vence}</td>
                    <td>
                        <button class="btn-edit" onclick="prepararEdicion(${i})"><i class="fa fa-sync"></i> RENOVAR</button>
                        <button onclick="eliminarSocio(${i})" style="background:none; border:none; color:#444; cursor:pointer; margin-left:10px;"><i class="fa fa-trash"></i></button>
                    </td>
                </tr>`;
            }
        });
    }

    function prepararEdicion(i) {
        const s = socios[i];
        document.getElementById('form-title').innerText = "Renovar / Editar Socio";
        document.getElementById('reg-nombre').value = s.nombre;
        document.getElementById('reg-plan').value = s.plan;
        document.getElementById('edit-index').value = i;
        document.getElementById('btn-save').innerText = "GUARDAR Y REIMPRIMIR";
        document.getElementById('btn-cancel').style.display = "block";
        show('registrar');
    }

    function cancelarEdicion() {
        document.getElementById('form-title').innerText = "Nuevo Registro";
        document.getElementById('reg-nombre').value = "";
        document.getElementById('edit-index').value = "-1";
        document.getElementById('btn-save').innerText = "REGISTRAR E IMPRIMIR";
        document.getElementById('btn-cancel').style.display = "none";
    }

    function eliminarSocio(i) {
        if(confirm("¬øEst√°s seguro de eliminar a este socio?")) {
            socios.splice(i, 1);
            localStorage.setItem('smg_data', JSON.stringify(socios));
            renderSocios();
        }
    }

    function imprimirTicket(s) {
        const t = document.getElementById('ticket-print');
        t.innerHTML = `
            <h2 style="margin:0;">S.M.G CENTER</h2>
            <p>¬°ENTRENA CON PASI√ìN!</p>
            <hr>
            <div style="text-align:left;">
                <b>SOCIO:</b> ${s.nombre}<br>
                <b>PLAN:</b> ${s.plan}<br>
                <b>INICIO:</b> ${s.inicio}
            </div>
            <hr>
            <h3 style="background:#000; color:#fff; padding:5px;">VENCE: ${s.vence}</h3>
            <hr>
            <p style="font-size:10px;">Conserva este ticket.<br>No hay devoluciones.</p>
        `;
        window.print();
    }

    // Registrar Service Worker para PWA
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js');
    }
</script>
</body>
</html>
