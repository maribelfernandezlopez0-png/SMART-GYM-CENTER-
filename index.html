<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>S.M.G CENTER | NEXUS SYSTEM</title>

    <link rel="manifest" href="/manifest.json"> 
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SMG Nexus">
    <link rel="apple-touch-icon" href="https://i.ibb.co/q04sK0C/dumbbell-icon.png"> 
    <link rel="icon" href="https://i.ibb.co/q04sK0C/dumbbell-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #ff0000; /* Red Accent */
            --primary-soft: #ffb7b2; /* Pastel Red */
            --bg: #0a0a0a; /* Dark Background */
            --panel: #1e1e1e; /* Panel Background */
            --card-border: #333333; /* Card Border */
            --text-light: #ffffff;
            --text-dim: #cccccc;
            --text-muted: #888888;

            --status-success: #b2f2bb; /* Pastel Green */
            --status-info: #b2e2f2;    /* Pastel Blue */
            --status-warning: #f1c40f; /* Gold for Debt */
            --status-error: #ffb7b2;   /* Pastel Red for Expired */

            --font-display: 'Orbitron', sans-serif;
            --font-body: 'Inter', sans-serif;
            --shadow-light: 0 4px 15px rgba(0,0,0,0.2);
            --shadow-dark: 0 8px 25px rgba(0,0,0,0.5);
        }

        /* Base Styles & Global Resets */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: var(--font-body); background-color: var(--bg); color: var(--text-light); 
            display: flex; height: 100vh; overflow: hidden; font-size: 14px;
        }

        /* Sidebar - Navigation */
        .sidebar { 
            width: 250px; background: #000; border-right: 2px solid var(--primary); 
            display: flex; flex-direction: column; flex-shrink: 0;
        }
        .brand-logo { padding: 30px 20px; text-align: center; border-bottom: 1px solid var(--card-border); }
        .brand-logo i { font-size: 48px; color: var(--primary); filter: drop-shadow(0 0 12px var(--primary)); }
        .brand-logo h2 { 
            font-family: var(--font-display); font-size: 18px; margin-top: 15px; 
            letter-spacing: 1.5px; color: var(--text-light);
        }

        .main-menu { flex: 1; padding: 15px 0; }
        .menu-item { 
            display: flex; align-items: center; padding: 15px 25px; color: var(--text-dim); 
            text-decoration: none; font-weight: 600; cursor: pointer; border-left: 4px solid transparent; 
            transition: all 0.2s ease-in-out; font-size: 13px;
        }
        .menu-item i { margin-right: 15px; font-size: 18px; width: 20px; text-align: center; }
        .menu-item:hover, .menu-item.active { 
            background: linear-gradient(90deg, rgba(255,0,0,0.1) 0%, transparent 100%);
            color: var(--text-light); border-left: 4px solid var(--primary);
        }

        /* Main Content Area */
        .content-area { 
            flex: 1; padding: 30px; overflow-y: auto; 
            background: radial-gradient(circle at top right, rgba(255,0,0,0.05), var(--bg) 80%);
        }
        .section-view { display: none; max-width: 1200px; margin: 0 auto; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .section-header { margin-bottom: 30px; }
        .section-header h1 { 
            font-family: var(--font-display); font-size: 28px; color: var(--primary); margin: 0; 
            border-left: 4px solid var(--primary); padding-left: 15px;
        }
        .section-header p { color: var(--text-dim); margin-top: 5px; font-size: 13px; }

        /* Widgets & Cards */
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }

        .data-card { 
            background: var(--panel); border: 1px solid var(--card-border); border-radius: 15px; 
            padding: 20px; text-align: center; position: relative; overflow: hidden;
            box-shadow: var(--shadow-dark);
        }
        .data-card::before { 
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; 
            background: linear-gradient(90deg, var(--primary), var(--primary-soft)); opacity: 0.6; 
        }
        .data-card h3 { 
            font-family: var(--font-display); font-size: 28px; margin: 10px 0 5px; 
            color: var(--text-light);
        }
        .data-card p { font-size: 11px; color: var(--text-muted); text-transform: uppercase; }

        /* Forms Styling */
        .form-panel { 
            background: var(--panel); border: 1px solid var(--card-border); border-radius: 20px; 
            padding: 35px; box-shadow: var(--shadow-dark);
        }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; }
        label { font-size: 10px; font-weight: 700; color: var(--primary-soft); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        input, select { 
            padding: 14px; background: #000; border: 1px solid var(--card-border); color: var(--text-light); 
            border-radius: 10px; font-size: 14px; outline: none; appearance: none;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        input:focus, select:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(255,0,0,0.3); }

        .btn-primary { 
            background: var(--primary); color: var(--text-light); border: none; padding: 18px; 
            border-radius: 12px; font-weight: 800; font-family: var(--font-display); cursor: pointer; 
            width: 100%; margin-top: 25px; letter-spacing: 1.5px; text-transform: uppercase;
            box-shadow: 0 5px 20px rgba(255,0,0,0.4);
            transition: all 0.3s ease;
        }
        .btn-primary:hover { transform: translateY(-2px) scale(1.01); filter: brightness(1.1); }
        .btn-secondary { 
            background: var(--panel); color: var(--text-dim); border: 1px solid var(--card-border); 
            padding: 12px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 12px;
            transition: all 0.2s ease;
        }
        .btn-secondary:hover { background: #333; color: var(--text-light); }

        /* Tables Styling */
        .table-wrapper { 
            background: var(--panel); border: 1px solid var(--card-border); border-radius: 20px; 
            overflow-x: auto; box-shadow: var(--shadow-dark);
        }
        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 600px; }
        th { 
            background: #000; padding: 18px 15px; text-align: center; color: var(--status-warning); 
            font-size: 11px; text-transform: uppercase; letter-spacing: 1px;
            position: sticky; top: 0; z-index: 1; /* For sticky header */
        }
        td { 
            padding: 15px; text-align: center; border-bottom: 1px solid var(--card-border); 
            color: var(--text-dim);
        }
        tr:last-child td { border-bottom: none; }
        
        .name-cell { font-weight: 700; color: var(--text-light); cursor: pointer; }
        .name-cell:hover { color: var(--primary-soft); text-decoration: underline; }

        .status-badge { 
            padding: 5px 10px; border-radius: 6px; font-size: 9px; font-weight: 800; 
            text-transform: uppercase; display: inline-block;
        }
        .status-badge.vigente { background: var(--status-success); color: #052c05; }
        .status-badge.vencido { background: var(--status-error); color: #5a0505; }
        .status-badge.deuda { background: var(--status-warning); color: #3a2500; }
        .status-badge.pagado { background: var(--status-info); color: #052c3a; }

        .action-btns button { 
            background: none; border: none; cursor: pointer; font-size: 16px; 
            color: var(--text-dim); margin: 0 5px; transition: color 0.2s ease;
        }
        .action-btns button:hover { color: var(--primary); }

        /* Modal Ficha de Socio */
        .modal-overlay { 
            display: none; position: fixed; top:0; left:0; width:100%; height:100%; 
            background: rgba(0,0,0,0.85); z-index: 9999; align-items: center; justify-content: center; 
            backdrop-filter: blur(8px); animation: fadeIn 0.3s ease;
        }
        .modal-content { 
            background: var(--panel); width: 100%; max-width: 400px; padding: 35px; 
            border-radius: 25px; border: 2px solid var(--primary); text-align: center; 
            box-shadow: var(--shadow-dark); animation: zoomIn 0.3s ease;
            position: relative;
        }
        @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-content img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--primary-soft); margin-bottom: 20px; object-fit: cover; }
        .modal-content h3 { font-family: var(--font-display); font-size: 24px; color: var(--text-light); margin-bottom: 5px; }
        .modal-content p.status { font-size: 12px; color: var(--text-dim); margin-bottom: 20px; }
        
        .ficha-details { 
            background: #000; padding: 20px; border-radius: 15px; text-align: left; 
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
        }
        .detail-item h5 { font-size: 9px; color: var(--text-muted); margin: 0; text-transform: uppercase; }
        .detail-item p { font-size: 13px; color: var(--text-light); margin: 5px 0 0; font-weight: 600; }
        .detail-item p.debt { color: var(--status-warning); font-weight: 800; }
        .close-modal-btn { 
            background: none; border: none; color: var(--text-dim); position: absolute; top: 15px; right: 15px; 
            font-size: 24px; cursor: pointer; transition: color 0.2s ease;
        }
        .close-modal-btn:hover { color: var(--primary); }

        /* Print Zone (Ticket) */
        #print-zone { display: none; width: 280px; padding: 20px; background: white; color: black; font-family: monospace; text-align: center; font-size: 12px; }
        @media print { 
            body * { visibility: hidden; } 
            #print-zone, #print-zone * { visibility: visible; } 
            #print-zone { position: absolute; left: 0; top: 0; display: block; }
        }

        /* Responsive Design for Mobile */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar { 
                width: 100%; height: 60px; border-right: none; border-top: 2px solid var(--primary); 
                order: 2; position: fixed; bottom: 0; 
            }
            .brand-logo { display: none; }
            .main-menu { display: flex; justify-content: space-around; padding: 0; }
            .menu-item { flex-direction: column; padding: 10px; font-size: 10px; border-left: none; border-top: 3px solid transparent; }
            .menu-item i { margin: 0 0 5px 0; font-size: 20px; }
            .menu-item:hover, .menu-item.active { border-left: none; border-top: 3px solid var(--primary); background: none; }

            .content-area { padding: 15px; padding-bottom: 75px; order: 1; }
            .section-header h1 { font-size: 22px; }
            .form-row { grid-template-columns: 1fr; }
            .grid-3, .grid-2 { grid-template-columns: 1fr 1fr; gap: 10px; }
            .data-card { padding: 15px; border-radius: 10px; }
            .data-card h3 { font-size: 22px; }
            .form-panel { padding: 20px; border-radius: 15px; }
            .table-wrapper { border-radius: 15px; }
            td { padding: 12px 8px; font-size: 12px; }
            th { padding: 12px 8px; font-size: 10px; }
            .ficha-details { grid-template-columns: 1fr; gap: 10px; }
        }

        /* Welcome Message Overlay */
        .welcome-overlay {
            display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 10000; align-items: center; justify-content: center;
            flex-direction: column; text-align: center; animation: fadeIn 0.5s ease;
        }
        .welcome-overlay h1 {
            font-family: var(--font-display); font-size: 3.5em; color: var(--primary);
            filter: drop-shadow(0 0 20px rgba(255,0,0,0.6)); margin-bottom: 20px;
        }
        .welcome-overlay p {
            font-size: 1.2em; color: var(--text-light); margin-bottom: 40px;
        }
        .welcome-overlay button {
            background: var(--primary); color: white; border: none; padding: 15px 30px;
            border-radius: 10px; font-size: 1.1em; font-weight: bold; cursor: pointer;
            box-shadow: 0 5px 15px rgba(255,0,0,0.4); transition: transform 0.2s ease;
        }
        .welcome-overlay button:hover { transform: translateY(-3px); }
    </style>
</head>
<body>

    <script>
        // Service Worker (for PWA installation)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js') // You need to create this file
                    .then(reg => console.log('Service Worker: Registered', reg))
                    .catch(err => console.log('Service Worker: Not Registered', err));
            });
        }
    </script>

    <div id="welcomeScreen" class="welcome-overlay">
        <h1>BIENVENIDO AL NEXUS</h1>
        <p>Sistema de Gesti√≥n S.M.G CENTER</p>
        <button onclick="hideWelcome()">INICIAR SISTEMA</button>
    </div>

    <div class="sidebar">
        <div class="brand-logo">
            <i class="fa-solid fa-dumbbell"></i>
            <h2>S.M.G CENTER</h2>
        </div>
        <nav class="main-menu">
            <div class="menu-item active" onclick="showSection('nexus-reg', this)"><i class="fa-solid fa-user-plus"></i> REGISTRO NEXUS</div>
            <div class="menu-item" onclick="showSection('nexus-socios', this)"><i class="fa-solid fa-users-gear"></i> PANEL SOCIOS</div>
            <div class="menu-item" onclick="showSection('nexus-caja', this)"><i class="fa-solid fa-cash-register"></i> CAJA | FINANZAS</div>
            <div class="menu-item" onclick="showSection('nexus-backup', this)"><i class="fa-solid fa-cloud-arrow-up"></i> BACKUP / RESTAURAR</div>
        </nav>
    </div>

    <div class="content-area">

        <div id="nexus-reg" class="section-view" style="display: block;">
            <div class="section-header">
                <h1>REGISTRO NEXUS</h1>
                <p>Gestiona nuevas membres√≠as y pagos de forma centralizada.</p>
            </div>
            <div class="form-panel">
                <div class="form-group" style="grid-column: span 2; margin-bottom: 20px;">
                    <label>NOMBRE COMPLETO DEL SOCIO</label>
                    <input type="text" id="reg-nombre" placeholder="EJ: CRISTIAN SORIANO">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>PLAN SELECCIONADO</label>
                        <select id="reg-plan" onchange="updateFinanceDetails(); calculateExpiryDate();">
                            <option value="SEMANAL">PLAN SEMANAL ($150)</option>
                            <option value="MENSUAL">PLAN MENSUAL ($380)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>FECHA DE INICIO DE MEMBRES√çA</label>
                        <input type="date" id="reg-inicio" onchange="calculateExpiryDate()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>MONTO ABONADO ($)</label>
                        <input type="number" id="reg-abono" onkeyup="updateFinanceDetails()">
                    </div>
                    <div class="form-group">
                        <label>M√âTODO DE PAGO</label>
                        <select id="reg-metodo">
                            <option value="EFECTIVO">EFECTIVO</option>
                            <option value="TRANSFERENCIA">TRANSFERENCIA</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>DEUDA PENDIENTE</label>
                        <input type="text" id="reg-deuda" readonly style="color:var(--status-warning); font-weight:800;">
                    </div>
                    <div class="form-group">
                        <label>FECHA DE VENCIMIENTO</label>
                        <input type="date" id="reg-vence" readonly style="color:var(--primary-soft); font-weight:800;">
                    </div>
                </div>
                <button class="btn-primary" onclick="saveNewMember()">REGISTRAR SOCIO Y EMITIR RECIBO</button>
            </div>
        </div>

        <div id="nexus-socios" class="section-view">
            <div class="section-header">
                <h1>PANEL DE SOCIOS</h1>
                <p>Vista general y gesti√≥n de todos los miembros.</p>
            </div>
            <div class="grid-3">
                <div class="data-card">
                    <p>TOTAL DE SOCIOS</p><h3 id="stat-total">0</h3>
                </div>
                <div class="data-card" style="border-top:4px solid var(--status-success);">
                    <p>MEMBRES√çAS VIGENTES</p><h3 id="stat-vigentes" style="color:var(--status-success);">0</h3>
                </div>
                <div class="data-card" style="border-top:4px solid var(--status-warning);">
                    <p>SOCIOS CON DEUDA</p><h3 id="stat-deuda" style="color:var(--status-warning);">0</h3>
                </div>
            </div>
            <input type="text" id="search-member" onkeyup="renderMembersTable()" placeholder="üîç BUSCAR SOCIO POR NOMBRE..." style="width:100%; margin-bottom:20px;">
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>SOCIO</th>
                            <th>ESTADO</th>
                            <th>DEUDA</th>
                            <th>VENCE</th>
                            <th>ACCIONES</th>
                        </tr>
                    </thead>
                    <tbody id="members-table-body"></tbody>
                </table>
            </div>
        </div>

        <div id="nexus-caja" class="section-view">
            <div class="section-header">
                <h1>CAJA | FINANZAS</h1>
                <p>Control detallado de ingresos y m√©todos de pago.</p>
            </div>
            <div class="grid-2">
                <div class="data-card" style="border-top:4px solid var(--status-success);">
                    <p>TOTAL EN EFECTIVO</p><h3 id="caja-efectivo" style="color:var(--status-success);">$0.00</h3>
                </div>
                <div class="data-card" style="border-top:4px solid var(--status-info);">
                    <p>TOTAL EN TRANSFERENCIAS</p><h3 id="caja-transferencia" style="color:var(--status-info);">$0.00</h3>
                </div>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>FECHA</th>
                            <th>SOCIO</th>
                            <th>M√âTODO</th>
                            <th>MONTO</th>
                        </tr>
                    </thead>
                    <tbody id="caja-table-body"></tbody>
                </table>
            </div>
        </div>

        <div id="nexus-backup" class="section-view">
            <div class="section-header">
                <h1>BACKUP / RESTAURAR</h1>
                <p>Protege tus datos y restaura informaci√≥n de socios y finanzas.</p>
            </div>
            <div class="form-panel" style="text-align: center;">
                <h3 style="font-family:var(--font-display); color:var(--primary); margin-bottom:20px;">GESTI√ìN DE DATOS</h3>
                <p style="color:var(--text-dim); margin-bottom:30px;">
                    Exporta tus datos a un archivo de texto para guardarlo de forma segura.
                    Tambi√©n puedes importar un archivo de respaldo para restaurar informaci√≥n.
                </p>
                <div class="form-row" style="grid-template-columns: 1fr;">
                    <button class="btn-secondary" onclick="exportData()">EXPORTAR DATOS (JSON)</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(event)">
                    <button class="btn-secondary" onclick="document.getElementById('import-file').click()">IMPORTAR DATOS (JSON)</button>
                </div>
            </div>
        </div>

    </div>

    <div id="memberFichaModal" class="modal-overlay" onclick="this.style.display='none'">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="close-modal-btn" onclick="document.getElementById('memberFichaModal').style.display='none'"><i class="fa-solid fa-xmark"></i></button>
            <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Socio Avatar">
            <h3 id="ficha-nombre">NOMBRE COMPLETO</h3>
            <p id="ficha-estado" class="status"></p>
            <div class="ficha-details">
                <div class="detail-item"><h5>PLAN</h5><p id="ficha-plan"></p></div>
                <div class="detail-item"><h5>INICIO</h5><p id="ficha-inicio"></p></div>
                <div class="detail-item"><h5>VENCIMIENTO</h5><p id="ficha-vence"></p></div>
                <div class="detail-item"><h5>√öLTIMO PAGO</h5><p id="ficha-pago"></p></div>
                <div class="detail-item"><h5>M√âTODO</h5><p id="ficha-metodo"></p></div>
                <div class="detail-item"><h5>DEUDA ACTUAL</h5><p id="ficha-deuda" class="debt"></p></div>
            </div>
            <button class="btn-primary" style="margin-top:25px; background:var(--panel); border:1px solid var(--card-border); color:var(--text-dim);" onclick="document.getElementById('memberFichaModal').style.display='none'">CERRAR</button>
        </div>
    </div>

    <div id="print-zone"></div>

    <script>
        // Data Storage (Local Storage)
        let membersDB = JSON.parse(localStorage.getItem('smg_nexus_members')) || [];
        let financeLog = JSON.parse(localStorage.getItem('smg_nexus_finance')) || [];

        // Welcome Screen Logic
        function hideWelcome() {
            document.getElementById('welcomeScreen').style.display = 'none';
        }

        // UI - Section Navigation
        function showSection(id, element) {
            document.querySelectorAll('.section-view').forEach(sec => sec.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            if (element) element.classList.add('active');

            // Refresh data when switching sections
            if (id === 'nexus-socios') renderMembersTable();
            if (id === 'nexus-caja') renderFinanceLog();
        }

        // --- REGISTRO NEXUS SECTION ---
        // Auto-fill payment and calculate debt
        function updateFinanceDetails() {
            const planValue = document.getElementById('reg-plan').value;
            const fullCost = (planValue === 'SEMANAL' ? 150 : 380);
            const amountPaid = parseFloat(document.getElementById('reg-abono').value) || 0;
            const remainingDebt = fullCost - amountPaid;
            document.getElementById('reg-deuda').value = "$" + remainingDebt.toFixed(2);
        }

        // Calculate expiry date based on start date and plan
        function calculateExpiryDate() {
            const startDateStr = document.getElementById('reg-inicio').value;
            if (!startDateStr) {
                document.getElementById('reg-vence').value = '';
                return;
            }
            let startDate = new Date(startDateStr + 'T00:00:00'); // 'T00:00:00' to avoid timezone issues
            const planValue = document.getElementById('reg-plan').value;
            
            let expiryDate = new Date(startDate);
            if (planValue === 'SEMANAL') {
                expiryDate.setDate(expiryDate.getDate() + 7);
            } else { // MENSUAL
                expiryDate.setDate(expiryDate.getDate() + 30);
            }
            expiryDate.setDate(expiryDate.getDate() - 1); // Vence un d√≠a antes de cumplir el ciclo

            document.getElementById('reg-vence').value = expiryDate.toISOString().split('T')[0];
        }

        // Save new member data
        function saveNewMember() {
            const nombre = document.getElementById('reg-nombre').value.toUpperCase().trim();
            const plan = document.getElementById('reg-plan').value;
            const inicio = document.getElementById('reg-inicio').value;
            const abono = document.getElementById('reg-abono').value;
            const deuda = document.getElementById('reg-deuda').value;
            const vence = document.getElementById('reg-vence').value;
            const metodo = document.getElementById('reg-metodo').value;

            if(!nombre || !inicio || !abono) {
                return alert("‚ö†Ô∏è ERROR: Por favor rellena el nombre, la fecha y el abono.");
            }

            const nuevoSocio = {
                id: Date.now(),
                nombre, plan, inicio, abono, deuda, vence, metodo
            };

            membersDB.push(nuevoSocio);
            financeLog.unshift({
                fecha: new Date().toLocaleDateString(),
                socio: nombre,
                monto: abono,
                metodo: metodo
            });

            saveToLocalStorage();
            alert("‚úÖ REGISTRO EXITOSO");
            imprimirTicket(nuevoSocio);
            resetForm();
            showSection('nexus-socios', document.querySelectorAll('.menu-item')[1]);
        }

        function saveToLocalStorage() {
            localStorage.setItem('smg_nexus_members', JSON.stringify(membersDB));
            localStorage.setItem('smg_nexus_finance', JSON.stringify(financeLog));
        }

        function renderMembersTable() {
            const tableBody = document.getElementById('members-table-body');
            const busqueda = document.getElementById('search-member').value.toUpperCase();
            const hoy = new Date().toISOString().split('T')[0];
            
            tableBody.innerHTML = '';
            let t=0, v=0, d=0;

            membersDB.forEach((s, index) => {
                if(s.nombre.includes(busqueda)) {
                    const esVigente = s.vence >= hoy;
                    const tieneDeuda = s.deuda !== "$0.00";
                    t++; if(esVigente) v++; if(tieneDeuda) d++;

                    tableBody.innerHTML += `
                        <tr>
                            <td class="name-cell" onclick="verFicha(${index})">${s.nombre}</td>
                            <td><span class="status-badge ${esVigente?'vigente':'vencido'}">${esVigente?'VIGENTE':'VENCIDO'}</span></td>
                            <td><span class="status-badge ${tieneDeuda?'deuda':'pagado'}">${s.deuda}</span></td>
                            <td>${s.vence}</td>
                            <td class="action-btns">
                                <button onclick="borrarSocio(${index})"><i class="fa fa-trash"></i></button>
                            </td>
                        </tr>`;
                }
            });
            document.getElementById('stat-total').innerText = t;
            document.getElementById('stat-vigentes').innerText = v;
            document.getElementById('stat-deuda').innerText = d;
        }

        function verFicha(i) {
            const s = membersDB[i];
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('ficha-nombre').innerText = s.nombre;
            document.getElementById('ficha-estado').innerText = s.vence >= hoy ? 'SOCIO ACTIVO' : 'SOCIO VENCIDO';
            document.getElementById('ficha-plan').innerText = s.plan;
            document.getElementById('ficha-inicio').innerText = s.inicio;
            document.getElementById('ficha-vence').innerText = s.vence;
            document.getElementById('ficha-pago').innerText = "$" + s.abono;
            document.getElementById('ficha-metodo').innerText = s.metodo;
            document.getElementById('ficha-deuda').innerText = s.deuda;
            document.getElementById('memberFichaModal').style.display = 'flex';
        }

        function renderFinanceLog() {
            let efec = 0, trans = 0;
            document.getElementById('caja-table-body').innerHTML = financeLog.map(f => {
                const montoNum = parseFloat(f.monto) || 0;
                if(f.metodo === 'EFECTIVO') efec += montoNum; else trans += montoNum;
                return `<tr><td>${f.fecha}</td><td>${f.socio}</td><td>${f.metodo}</td><td>$${montoNum.toFixed(2)}</td></tr>`;
            }).join('');
            document.getElementById('caja-efectivo').innerText = "$" + efec.toFixed(2);
            document.getElementById('caja-transferencia').innerText = "$" + trans.toFixed(2);
        }

        function exportData() {
            const data = { members: membersDB, finance: financeLog };
            const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `SMG_BACKUP_${new Date().toLocaleDateString().replace(/\//g,'-')}.json`;
            a.click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if(imported.members && imported.finance) {
                        membersDB = imported.members;
                        financeLog = imported.finance;
                        saveToLocalStorage();
                        alert("‚úÖ Datos restaurados con √©xito.");
                        location.reload();
                    }
                } catch (err) { alert("‚ùå Archivo no v√°lido."); }
            };
            reader.readAsText(file);
        }

        function borrarSocio(i) {
            if(confirm("¬øEliminar este socio? Esta acci√≥n no se puede deshacer.")) {
                membersDB.splice(i, 1);
                saveToLocalStorage();
                renderMembersTable();
            }
        }

        function imprimirTicket(s) {
            const zone = document.getElementById('print-zone');
            zone.innerHTML = `
                <div style="font-family:monospace; text-align:center;">
                    <h2 style="margin:0;">S.M.G CENTER</h2>
                    <p>RECIBO DE PAGO</p>
                    <hr>
                    <div style="text-align:left;">
                        Socio: ${s.nombre}<br>
                        Plan: ${s.plan}<br>
                        Fecha: ${new Date().toLocaleDateString()}<br>
                        Pag√≥: $${s.abono}<br>
                        Deuda: ${s.deuda}
                    </div>
                    <hr>
                    <h3 style="margin:5px 0;">VENCE: ${s.vence}</h3>
                    <p>PROHIBIDO RENDIRSE</p>
                </div>
            `;
            window.print();
        }

        function resetForm() {
            document.getElementById('reg-nombre').value = '';
            document.getElementById('reg-abono').value = '';
            updateFinanceDetails();
            calculateExpiryDate();
        }

        // Inicializaci√≥n al cargar
        window.onload = () => {
            document.getElementById('reg-inicio').valueAsDate = new Date();
            updateFinanceDetails();
            calculateExpiryDate();
        }
    </script>
</body>
</html>

