<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.M.G CENTER - ELITE SYSTEM</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --dark: #050505; --card: #0f0f0f; --accent: #ff0000; --gold: #ffcc00; --text: #ffffff; --green: #00ff44; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--dark); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        /* SIDEBAR */
        .sidebar { width: 260px; background: #000; border-right: 2px solid var(--accent); display: flex; flex-direction: column; }
        .logo-box { padding: 40px 20px; text-align: center; border-bottom: 1px solid #222; }
        .logo-box i { font-size: 50px; color: var(--accent); filter: drop-shadow(0 0 10px red); }
        .sidebar nav a { display: flex; align-items: center; padding: 18px 25px; color: #888; text-decoration: none; font-size: 13px; font-weight: bold; text-transform: uppercase; cursor: pointer; transition: 0.3s; }
        .sidebar nav a:hover, .sidebar nav a.active { background: #111; color: #fff; border-left: 5px solid var(--accent); }
        .sidebar nav a i { margin-right: 15px; width: 20px; text-align: center; }

        /* MAIN */
        .main { flex: 1; padding: 40px; overflow-y: auto; background: radial-gradient(circle at top right, #1a0000 0%, #000 100%); }
        h2 { color: var(--accent); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 25px; border-left: 5px solid var(--accent); padding-left: 15px; }

        /* DASHBOARD */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid #222; text-align: center; border-bottom: 3px solid transparent; }
        .stat-card:hover { border-bottom-color: var(--accent); }
        .stat-card i { font-size: 22px; color: var(--accent); margin-bottom: 10px; }
        .stat-card h3 { margin: 0; font-size: 28px; color: var(--gold); font-family: 'Courier New'; }

        .glass-panel { background: var(--card); padding: 30px; border-radius: 15px; border: 1px solid #222; box-shadow: 0 10px 40px rgba(0,0,0,0.7); }
        
        /* TABLAS Y BUSCADOR */
        .search-box { width: 100%; padding: 15px; background: #111; border: 1px solid #333; color: #fff; border-radius: 10px; margin-bottom: 20px; font-size: 16px; }
        table { width: 100%; border-collapse: collapse; }
        th { color: var(--gold); font-size: 11px; padding: 15px; border-bottom: 2px solid var(--accent); text-align: center; }
        td { padding: 15px; border-bottom: 1px solid #222; text-align: center; }

        /* BOTONES */
        .btn-main { background: var(--accent); color: white; border: none; padding: 15px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; text-transform: uppercase; margin-top: 10px; }
        .btn-action { background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 11px; margin: 2px; }
        .btn-action:hover { background: var(--gold); color: black; }
        .btn-delete { border-color: #ff4444; color: #ff4444; }
        .btn-delete:hover { background: #ff4444; color: white; }

        /* STATUS */
        .badge { padding: 4px 10px; border-radius: 4px; font-weight: bold; font-size: 10px; }
        .bg-vigente { background: var(--green); color: black; }
        .bg-vencido { background: var(--accent); color: white; }

        /* TICKET DISEÃ‘O */
        #ticket-print { display: none; width: 280px; padding: 20px; background: white; color: black; font-family: 'Courier New', monospace; text-align: center; border: 2px dashed black; }
        .ticket-header { border-bottom: 2px solid black; margin-bottom: 10px; padding-bottom: 10px; }
        
        @media print { body * { visibility: hidden; } #ticket-print, #ticket-print * { visibility: visible; } #ticket-print { position: absolute; left: 0; top: 0; display: block; } }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo-box"><i class="fa-solid fa-dumbbell"></i><div style="margin-top:10px; font-weight:bold; letter-spacing:2px;">S.M.G CENTER</div></div>
    <nav>
        <a onclick="show('registrar')" id="n-registrar" class="active"><i class="fa fa-user-plus"></i> REGISTRAR</a>
        <a onclick="show('lista')" id="n-lista"><i class="fa fa-users"></i> SOCIOS</a>
        <a onclick="show('historial')" id="n-historial"><i class="fa fa-file-invoice-dollar"></i> HISTORIAL</a>
    </nav>
</div>

<div class="main">
    <div id="registrar" class="section">
        <h2 id="form-title">Nuevo Registro</h2>
        <div class="glass-panel" style="max-width: 500px;">
            <input type="hidden" id="edit-index" value="-1">
            <label style="font-size:11px; color:#888;">NOMBRE DEL SOCIO</label>
            <input type="text" id="reg-nombre" placeholder="NOMBRE COMPLETO" style="width:100%; padding:12px; background:#000; border:1px solid #333; color:white; margin-bottom:20px; border-radius:8px;">
            
            <div style="display:flex; gap:15px; margin-bottom:20px;">
                <div style="flex:1;">
                    <label style="font-size:11px; color:#888;">INICIO</label>
                    <input type="date" id="reg-inicio" onchange="calcVence()" style="width:100%; padding:12px; background:#000; border:1px solid #333; color:white; border-radius:8px;">
                </div>
                <div style="flex:1;">
                    <label style="font-size:11px; color:#888;">PLAN</label>
                    <select id="reg-plan" onchange="calcVence()" style="width:100%; padding:12px; background:#000; border:1px solid #333; color:white; border-radius:8px;">
                        <option value="SEMANAL">SEMANAL ($150)</option>
                        <option value="MENSUAL">MENSUAL ($380)</option>
                    </select>
                </div>
            </div>
            
            <label style="font-size:11px; color:var(--accent); font-weight:bold;">FECHA DE VENCIMIENTO (PAGO):</label>
            <input type="date" id="reg-vence" readonly style="width:100%; padding:12px; background:#111; border:1px solid var(--accent); color:var(--accent); font-weight:bold; text-align:center; border-radius:8px; margin-bottom:20px;">
            
            <button class="btn-main" onclick="guardarSocio()">GUARDAR E IMPRIMIR RECIBO</button>
            <button id="btn-cancel" onclick="cancelarEdicion()" style="display:none; width:100%; background:#333; border:none; color:white; padding:10px; margin-top:10px; border-radius:8px; cursor:pointer;">CANCELAR</button>
        </div>
    </div>

    <div id="lista" class="section" style="display:none;">
        <div class="stats-grid">
            <div class="stat-card"><i class="fa fa-users"></i><h3 id="stat-total">0</h3><p>TOTAL</p></div>
            <div class="stat-card"><i class="fa fa-heartbeat" style="color:var(--green)"></i><h3 id="stat-vigente">0</h3><p>VIGENTES</p></div>
            <div class="stat-card"><i class="fa fa-clock" style="color:var(--accent)"></i><h3 id="stat-vencido">0</h3><p>VENCIDOS</p></div>
        </div>
        <h2>Control de Socios</h2>
        <input type="text" class="search-box" id="buscador" placeholder="ðŸ” Buscar socio por nombre..." onkeyup="renderSocios()">
        <div class="glass-panel">
            <table>
                <thead><tr><th>Socio</th><th>Estado</th><th>Vencimiento</th><th>Acciones</th></tr></thead>
                <tbody id="lista-socios"></tbody>
            </table>
        </div>
    </div>

    <div id="historial" class="section" style="display:none;">
        <h2>Historial de Recibos Emitidos</h2>
        <div class="glass-panel">
            <table>
                <thead><tr><th>Fecha Pago</th><th>Socio</th><th>Monto</th><th>Plan</th></tr></thead>
                <tbody id="lista-historial"></tbody>
            </table>
        </div>
    </div>
</div>

<div id="ticket-print">
    <div class="ticket-header">
        <h2 style="margin:0;">S.M.G CENTER</h2>
        <p style="font-size:12px; margin:5px;">"Forjando Fuerza"</p>
    </div>
    <div style="text-align:left; font-size:14px; margin-top:10px;">
        <b>RECIBO DE PAGO</b><br>
        FECHA: <span id="t-hoy"></span><br>
        SOCIO: <span id="t-nombre"></span><br>
        PLAN: <span id="t-plan"></span><br>
        <hr style="border:1px dashed #000">
        <h3 style="margin:10px 0; text-align:center;">VENCE: <span id="t-vence"></span></h3>
        <hr style="border:1px dashed #000">
        <p style="font-size:10px; text-align:center;">Este ticket es tu comprobante de acceso.<br>Â¡A DARLE CON TODO!</p>
    </div>
</div>

<script>
    let socios = JSON.parse(localStorage.getItem('smg_data')) || [];
    let recibos = JSON.parse(localStorage.getItem('smg_historial')) || [];
    const bip = new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3');

    function show(id) {
        document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
        document.getElementById('n-'+id).classList.add('active');
        if(id === 'lista') renderSocios();
        if(id === 'historial') renderHistorial();
    }

    function calcVence() {
        const inicio = document.getElementById('reg-inicio').value;
        if(!inicio) return;
        const fecha = new Date(inicio + 'T00:00:00');
        const plan = document.getElementById('reg-plan').value;
        // LÃ³gica: Sumar 30 dÃ­as o 7 dÃ­as y restar 1 para que el dÃ­a del pago ya sea "Vencido"
        fecha.setDate(fecha.getDate() + (plan === 'SEMANAL' ? 7 : 30));
        fecha.setDate(fecha.getDate() - 1); 
        document.getElementById('reg-vence').value = fecha.toISOString().split('T')[0];
    }

    function guardarSocio() {
        const nombre = document.getElementById('reg-nombre').value.toUpperCase();
        const vence = document.getElementById('reg-vence').value;
        const inicio = document.getElementById('reg-inicio').value;
        const plan = document.getElementById('reg-plan').value;
        const index = document.getElementById('edit-index').value;

        if(!nombre || !vence || !inicio) return alert("Completa todos los campos");

        const datos = { nombre, vence, inicio, plan };

        if(index === "-1") {
            socios.push(datos);
        } else {
            socios[index] = datos;
            cancelarEdicion();
        }

        // Guardar en Historial
        recibos.unshift({ fecha: new Date().toLocaleDateString(), nombre, plan, monto: plan==='SEMANAL'?'$150':'$380' });
        
        localStorage.setItem('smg_data', JSON.stringify(socios));
        localStorage.setItem('smg_historial', JSON.stringify(recibos));
        
        bip.play();
        lanzarTicket(datos);
        show('lista');
    }

    function renderSocios() {
        const tbody = document.getElementById('lista-socios');
        const filtro = document.getElementById('buscador').value.toUpperCase();
        const hoy = new Date().toISOString().split('T')[0];
        tbody.innerHTML = '';
        
        let countV = 0, countX = 0;

        socios.forEach((s, i) => {
            if(s.nombre.includes(filtro)) {
                const vigente = s.vence >= hoy;
                if(vigente) countV++; else countX++;
                tbody.innerHTML += `<tr>
                    <td style="text-align:left;"><b>${s.nombre}</b></td>
                    <td><span class="badge ${vigente?'bg-vigente':'bg-vencido'}">${vigente?'VIGENTE':'PAGO PENDIENTE'}</span></td>
                    <td>${s.vence}</td>
                    <td>
                        <button class="btn-action" onclick="prepararRenovar(${i})">RENOVAR</button>
                        <button class="btn-action btn-delete" onclick="eliminarSocio(${i})">ELIMINAR</button>
                    </td>
                </tr>`;
            }
        });
        document.getElementById('stat-total').innerText = socios.length;
        document.getElementById('stat-vigente').innerText = countV;
        document.getElementById('stat-vencido').innerText = countX;
    }

    function renderHistorial() {
        const tbody = document.getElementById('lista-historial');
        tbody.innerHTML = recibos.map(r => `<tr><td>${r.fecha}</td><td>${r.nombre}</td><td>${r.monto}</td><td>${r.plan}</td></tr>`).join('');
    }

    function eliminarSocio(i) {
        if(confirm("Â¿Eliminar socio definitivamente?")) {
            socios.splice(i, 1);
            localStorage.setItem('smg_data', JSON.stringify(socios));
            renderSocios();
        }
    }

    function prepararRenovar(i) {
        const s = socios[i];
        document.getElementById('form-title').innerText = "RenovaciÃ³n de Socio";
        document.getElementById('reg-nombre').value = s.nombre;
        document.getElementById('edit-index').value = i;
        document.getElementById('btn-cancel').style.display = "block";
        show('registrar');
    }

    function cancelarEdicion() {
        document.getElementById('form-title').innerText = "Nuevo Registro";
        document.getElementById('reg-nombre').value = "";
        document.getElementById('edit-index').value = "-1";
        document.getElementById('btn-cancel').style.display = "none";
    }

    function lanzarTicket(s) {
        document.getElementById('t-hoy').innerText = new Date().toLocaleDateString();
        document.getElementById('t-nombre').innerText = s.nombre;
        document.getElementById('t-plan').innerText = s.plan;
        document.getElementById('t-vence').innerText = s.vence;
        window.print();
    }
</script>
</body>
</html>


